(()=>{"use strict";var t={961:(t,i,e)=>{e.r(i),e.d(i,{default:()=>s});const s=e.p+"images/63e90eb99bc6ad2ebd170eecc988eba8.svg"},559:(t,i,e)=>{e.r(i),e.d(i,{default:()=>s});const s=e.p+"images/38f579ea643d03a228481806c9b414d3.svg"}},i={};function e(s){var a=i[s];if(void 0!==a)return a.exports;var r=i[s]={exports:{}};return t[s](r,r.exports,e),r.exports}e.d=(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var i=e.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var s=i.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),(()=>{class t{constructor(t=0,i=0){this.x=t,this.y=i}addSelf(t){return this.x+=t.x,this.y+=t.y,this}add(t){return this.clone().addSelf(t)}subtractSelf(t){return this.x-=t.x,this.y-=t.y,this}subtract(t){return this.clone().subtractSelf(t)}scaleSelf(t){return this.x*=t,this.y*=t,this}scale(t){return this.clone().scaleSelf(t)}setPolar(t,i){return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this}static fromPolar(i,e){let s=e*Math.cos(i),a=e*Math.sin(i);return new t(s,a)}rotateSelf(t){let i=this.azimuth(),e=this.length();return this.setPolar(i+t,e)}rotate(t){return this.clone().rotateSelf(t)}negateSelf(){return this.scaleSelf(-1)}negateXSelf(){return this.x*=-1,this}negateYSelf(){return this.y*=-1,this}negate(){return this.clone().negateSelf()}length(){return Math.sqrt(this.x**2+this.y**2)}azimuth(){return Math.atan2(this.y,this.x)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angleTo(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}distanceTo(t){return Math.sqrt(this.distanceTo2(t))}distanceTo2(t){return(this.x-t.x)**2+(this.y-t.y)**2}clone(){return new t(this.x,this.y)}static lerp(i,e,s){let a=i.x+(e.x-i.x)*s,r=i.y+(e.y-i.y)*s;return new t(a,r)}}function i(i){return new t(i.canvas.width/2,i.canvas.height/2)}var s;!function(t){t[t.FLYING=0]="FLYING",t[t.LANDING=1]="LANDING",t[t.TAXIING=2]="TAXIING",t[t.PARKED=3]="PARKED",t[t.REARMING=4]="REARMING",t[t.TAKEOFF_RDY=5]="TAKEOFF_RDY",t[t.TAKEOFF=6]="TAKEOFF"}(s||(s={}));const a={phone:{XSmall:10,Small:12,Medium:15,Large:20,XLarge:40},tablet:{XSmall:10,Small:15,Medium:20,Large:40,XLarge:80}};class r{constructor(t){this.isLoaded=!1,this.width=0,this.height=0,this.image=new Image,this.image.src=t;let i=this;this.image.onload=function(){i.isLoaded=!0,i.width=i.image.width,i.height=i.image.height}}draw(t,i,e,s,a=1){if(!this.isLoaded)return;t.save(),t.translate(i.x,i.y),t.rotate(e);let r=this.width*s,h=this.height*s;t.globalAlpha=a,t.drawImage(this.image,-r/2,-h/2,r,h),t.restore()}}function h(t,i,e){t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(e.x,e.y),t.stroke()}const n=2*Math.PI,o=Math.PI/2;function c(t,i){return Math.floor(Math.random()*(i-t+1))+t}Number.prototype.between=function(t,i,e){let s=Math.min.apply(Math,[t,i]),a=Math.max.apply(Math,[t,i]);return e?this>=s&&this<=a:this>s&&this<a},Number.prototype.clamp=function(t,i){return Math.min(Math.max(this.valueOf(),t),i)};const l=e(961);class d{constructor(t){this.position=t}}class p extends d{constructor(t,i){super(t),this.direction=i}}class f extends EventTarget{constructor(i,e,a){super(),this.config={scale:{flying:1,taxiing:.5},speed:{flying:.025,taxiing:.015},hitbox:{maxRadius:20},turnRate:.002,catchArrestorWireDelay:3e3,image:{path:l.default,scale:.2},collision:{minScaleDiff:.42}},this._state=s.FLYING,this._hasFinalApproch=!1,this.path=[],this.catchArrestorWireTime=0,this.rearming={progress:-1,nextUpdateTime:0,duration:-1},this.collision={collided:!1,protection:{enabled:!1,duration:-1,disableTime:0}},this.opacity={step:.001,min:.3,max:1,value:1,direction:-1},this.scale=this.config.scale.flying,this.speed=this.config.speed.flying,this.image=new r(this.config.image.path),this.position=i,this.flyZone=a,this.disableBorderBounce=this.isOutsideFlyzone(),this.velocity=t.fromPolar(e,this.speed)}get state(){return this._state}get hasFinalApproch(){return this._hasFinalApproch}update(t){this.updateSpawnProtection(t),this._state!==s.PARKED&&this._state!==s.TAKEOFF_RDY&&(this._state===s.REARMING&&this.updateRearm(t),this._state===s.LANDING&&(this.updateLandingSpeed(t),this.updateLandingScale(t)),!(this._state===s.TAKEOFF&&(this.updateTakeoffSpeed(),this.updateTakeoffScale(t),0===this.path.length)||this._state===s.FLYING&&(this.handleLeavingFlyZone(),0===this.path.length))?0!==this.path.length&&this.moveToWaypoint(t):this.moveStraight(t))}addWaypoint(t){if(this._state===s.PARKED&&(this._state=s.TAXIING),this._hasFinalApproch)return;let i=this.path.length>0?this.path[this.path.length-1].position:this.position;t.subtract(i).length()<this.hitboxRadius()/2||this.path.push(new d(t))}addParkingWaypoint(t,i){this._state===s.PARKED&&(this._state=s.TAXIING),this.path.push(new p(t,i))}disableCollision(t){t<=0||(this.collision.protection.enabled=!0,this.collision.protection.duration=t)}startRearm(t){if(t<=0)throw new Error("Duration must be greater zero!");this.clearPath(),this._state=s.REARMING,this.rearming={progress:0,nextUpdateTime:0,duration:t}}hasFinishedRearming(){return 100===this.rearming.progress}prepareTakeoff(){this._state=s.TAKEOFF_RDY}takeoff(){this._state=s.TAKEOFF}addFinalApproch(t){this._hasFinalApproch||(this._hasFinalApproch=!0,this.path.push(new d(t)))}clearPath(){this._hasFinalApproch=!1,this.path=[]}isOutsideFlyzone(){return this.flyZone.isHitboxOutside(this.position,this.hitboxRadius())}isPositionInUnscaledHitbox(t){return this.position.distanceTo2(t)<this.config.hitbox.maxRadius**2}collidesWith(t){if(this.collision.protection.enabled||t.collision.protection.enabled)return!1;if(!this.statesAreCollidable(this._state,t._state)||!this.nearlySameScale(t.scale))return!1;let i=t.hitboxRadius()+this.hitboxRadius();return this.position.distanceTo2(t.position)<i**2}setCollided(){this.collision.collided=!0}draw(t,i=!1){this._state===s.REARMING&&this.drawRearmProgress(t),this._state===s.TAKEOFF_RDY&&this.drawFinishedCheckmark(t,"green"),this.collision.collided&&this.drawHitbox(t,"red"),i&&this.drawHitbox(t,"darkgray",.5,5),this.drawAircraftImage(t)}drawPath(t){if(this._state===s.FLYING&&0!==this.path.length){t.strokeStyle=this._hasFinalApproch?"yellow":"red",t.lineWidth=2,h(t,this.position,this.path[0].position);for(let i=0;i<this.path.length-1;i++)h(t,this.path[i].position,this.path[i+1].position)}}drawProgressBar(t,i,e,s,a,r,h){h<0&&(h=0),h>100&&(h=100);let n=s/100*h,o=i-s/2,c=e-a/2;t.fillStyle=r,t.fillRect(o,c,n,a),t.strokeStyle="black",t.lineWidth=1,t.strokeRect(o,c,s,a)}drawAircraftImage(t){let i=this.opacity.value.clamp(this.opacity.min,this.opacity.max);this.image.draw(t,this.position,this.velocity.azimuth(),this.config.image.scale*this.scale,i)}drawRearmProgress(t){if(this.rearming.progress<0)return;if(this.hasFinishedRearming())return void this.drawFinishedCheckmark(t,"green");let i=2*this.hitboxRadius(),e=this.position.x,s=this.position.y-i;this.drawProgressBar(t,e,s,i,5,"yellow",this.rearming.progress)}drawFinishedCheckmark(t,i){let e=this.position.x,s=this.position.y-2*this.hitboxRadius();t.save(),t.translate(e,s),t.rotate(Math.PI/4);t.beginPath(),t.strokeStyle="black",t.lineWidth=5,t.moveTo(-8,0),t.lineTo(0,0),t.lineTo(0,-15),t.stroke(),t.beginPath(),t.strokeStyle=i,t.lineWidth=3,t.moveTo(-7,0),t.lineTo(0,0),t.lineTo(0,-14),t.stroke(),t.restore()}drawHitbox(t,i,e=1,s=0){t.globalAlpha=e,t.fillStyle=i,t.beginPath(),t.arc(this.position.x,this.position.y,this.hitboxRadius()+s,0,n),t.fill(),t.globalAlpha=1}hitboxRadius(){return this.scale*this.config.hitbox.maxRadius}moveStraight(t){this.position.addSelf(this.velocity.scale(t.elapsed))}moveToWaypoint(t){let i=this.path[0];if(void 0===i)throw new Error("No Waypoint to move to defined.");let e=i instanceof p;e&&this._state!==s.TAXIING&&(this._state=s.TAXIING);let a=i.position.subtract(this.position),r=a.length()<this.hitboxRadius();if(r&&(e?a.setPolar(i.direction,1):this.path.shift()),0!==this.path.length){if(this.velocity.angleTo(a)>(e?.05:.1)){let i=this.velocity.cross(a)>0?1:-1;this.velocity.rotateSelf(this.config.turnRate*i*t.elapsed)}else e&&r&&(console.log("reached the parking position and aligned accordingly"),this.path.shift(),0===this.path.length&&(this._state=s.PARKED,this.dispatchEvent(new Event("parked"))));this.position.addSelf(this.velocity.scale(t.elapsed))}else this._hasFinalApproch?(this._state=s.LANDING,this._hasFinalApproch=!1,this.dispatchEvent(new Event("landing"))):this._state!==s.FLYING&&this._state!==s.TAKEOFF&&(this._state=s.PARKED)}handleLeavingFlyZone(){let t=this.isOutsideFlyzone();!this.disableBorderBounce&&t?this.velocity.rotateSelf(Math.PI):this.disableBorderBounce&&!t&&(this.disableBorderBounce=!1)}updateLandingScale(t){this.scale>this.config.scale.taxiing&&(this.scale-=this.config.scale.flying/100*.02*t.elapsed)}updateLandingSpeed(t){if(0===this.catchArrestorWireTime&&(this.catchArrestorWireTime=t.lastUpdate+this.config.catchArrestorWireDelay),this.speed>this.config.speed.taxiing&&t.lastUpdate>this.catchArrestorWireTime){let t=this.speed>1.7*this.config.speed.taxiing?this.config.speed.flying/100*5:this.config.speed.flying/100*.25;this.speed-=t,this.velocity.scaleSelf(this.speed/(this.speed+t))}}updateTakeoffScale(t){this.scale<this.config.scale.flying&&(this.scale+=this.config.scale.flying/100*.003*t.elapsed)}updateTakeoffSpeed(){if(this.speed<this.config.speed.flying){let t=this.speed<.9*this.config.speed.flying?this.config.speed.flying/100*5:this.config.speed.flying/100*.25;this.speed+=t,this.velocity.scaleSelf(this.speed/(this.speed-t))}}updateRearm(t){t.lastUpdate<=this.rearming.nextUpdateTime||(this.rearming.nextUpdateTime=t.lastUpdate+this.rearming.duration/100,this.rearming.progress++,this.hasFinishedRearming()&&(this.rearming.nextUpdateTime=1/0))}updateSpawnProtection(t){this.collision.protection.enabled&&(0===this.collision.protection.disableTime&&(this.collision.protection.disableTime=t.lastUpdate+this.collision.protection.duration),this.opacity.value+=this.opacity.step*this.opacity.direction*t.elapsed,this.opacity.value<this.opacity.min&&(this.opacity.direction=1),this.opacity.value>this.opacity.max&&(this.opacity.direction=-1),t.lastUpdate>this.collision.protection.disableTime&&(this.collision.protection.enabled=!1,this.collision.protection.duration=-1,this.opacity.value=1))}statesAreCollidable(t,i){let e=t===s.FLYING&&i===s.FLYING,a=this.xor(t===s.TAKEOFF,i===s.TAKEOFF);return e||a}nearlySameScale(t){return Math.abs(this.scale-t)<this.config.collision.minScaleDiff}xor(t,i){return t&&!i||!t&&i}}class u{constructor(t,i){this.position=t,this.direction=i,this.aircraft=null}isEmpty(){return null===this.aircraft}}class g extends u{constructor(t,i,e){super(t,i),this.queue=e}hasQueueSpace(){return this.isEmpty()||this.queue.some((t=>t.isEmpty()))}addToQueue(t){if(this.isEmpty())return this.aircraft=t,this;for(const i of this.queue)if(i.isEmpty())return i.aircraft=t,i;return null}shiftQueue(){let t=[this,...this.queue];this.aircraft=null;for(let i=0;i<t.length-1;i++){let e=t[i],s=t[i+1];e.isEmpty()&&(e.aircraft=s.aircraft,s.aircraft=null)}return t}}class w{constructor(i,e,s){this.closed=!1,this.opacity={step:.001,min:.1,max:1,value:1,direction:-1},this.start=i,this.end=e,this.snapDistance=s,this.maxLeft=t.fromPolar(5*Math.PI/8,s).addSelf(i),this.maxRight=t.fromPolar(3*Math.PI/8,s).addSelf(i),this.maxLeftAzimuth=this.maxLeft.subtract(i).negateSelf().azimuth(),this.maxRightAzimuth=this.maxRight.subtract(i).negateSelf().azimuth()}update(t){this.updateApproachOpacity(t)}updateApproachOpacity(t){this.opacity.value+=this.opacity.step*this.opacity.direction*t.elapsed,this.opacity.value<this.opacity.min&&(this.opacity.direction=1),this.opacity.value>this.opacity.max&&(this.opacity.direction=-1)}draw(i,e=!1,s=!1){if(e&&!this.closed){i.lineWidth=5,s?(i.strokeStyle="green",i.globalAlpha=1):(i.strokeStyle="darkgray",i.globalAlpha=this.opacity.value.clamp(this.opacity.min,this.opacity.max)),h(i,this.maxLeft,this.start),h(i,this.maxRight,this.start);let e=30;h(i,this.maxLeft.add(new t(0,e)),this.start.add(new t(0,e))),h(i,this.maxRight.add(new t(0,e)),this.start.add(new t(0,e))),h(i,this.maxLeft.add(new t(0,2*e)),this.start.add(new t(0,2*e))),h(i,this.maxRight.add(new t(0,2*e)),this.start.add(new t(0,2*e)))}i.globalAlpha=1,i.fillStyle=this.closed?"red":"green",i.beginPath(),i.arc(this.start.x-25,this.start.y-10,2,0,n),i.fill()}}class m{constructor(t,i,e,s=0){this.center=t,this.width=i,this.height=e,this.angle=s;let a=new DOMMatrix;a.translateSelf(t.x,t.y),0!==s&&a.rotateSelf(180*s/Math.PI),this.transformation=a,this.invTransformation=this.transformation.inverse()}isInside(t){let i=this.transformPosition(t);return this.isXInside(i.x)&&this.isYInside(i.y)}transformPosition(i){let e=this.invTransformation.transformPoint(new DOMPoint(i.x,i.y));return new t(e.x,e.y)}isXInside(t){return t.between(-this.width/2,this.width/2,!0)}isYInside(t){return t.between(-this.height/2,this.height/2,!0)}draw(t){t.save(),t.setTransform(this.transformation),t.fillRect(-this.width/2,-this.height/2,this.width,this.height),t.restore()}}class y extends m{constructor(t,i,e){if(super(t.center,t.width,t.height,t.angle),this.width<i+e)throw new Error("Start and end width exceed the complete area width");this.startWidth=i,this.endWidth=e}isInsideStart(t){let i=this.transformPosition(t),e=-this.width/2,s=e+this.startWidth;return i.x.between(e,s,!0)&&this.isYInside(i.y)}isInsideEnd(t){let i=this.transformPosition(t),e=this.width/2,s=e-this.endWidth;return i.x.between(s,e,!0)&&this.isYInside(i.y)}draw(t){t.globalAlpha=.5,t.fillStyle="red",super.draw(t),t.save(),t.setTransform(this.transformation),t.fillStyle="orange",t.fillRect(-this.width/2,-this.height/2,this.startWidth,this.height),t.fillRect(this.width/2-this.endWidth,-this.height/2,this.endWidth,this.height),t.restore()}}class x extends u{constructor(t,i,e){super(t,i),this.path=e}}const A=e(559);class b{constructor(i){this.config={scale:1.5,direction:.18-o,rearmDuration:4e3},this.takeoffPositions=[],this.center=i,this.image=new r(A.default);let e=i.x-28,s=i.y-88,a=i.y+209;this.runway=new w(new t(e,a),new t(e,s),50);let h=[new u(this.absPos(28,-5),this.config.direction),new u(this.absPos(22,30),this.config.direction)];this.rearmPosition=new g(this.absPos(52,-35),this.config.direction,h),this.takeoffPositions.push(new x(this.absPos(-1,-84),this.config.direction,[this.absPos(29,-222),this.absPos(14,-375)])),this.takeoffPositions.push(new x(this.absPos(18,-83),this.config.direction,[this.absPos(46,-219),this.absPos(57,-375)])),this.takeoffSwipeArea=new y(new m(this.absPos(25,-145),180,80,this.config.direction),60,60),this.eventhandlers={landing:this.handlerGenerator(this.onAircraftLanding),parked:this.handlerGenerator(this.onAircraftParked)}}addAircraftEventHandler(t){t.addEventListener("landing",this.eventhandlers.landing),t.addEventListener("parked",this.eventhandlers.parked)}removeAircraftEventHandler(t){t.removeEventListener("landing",this.eventhandlers.landing),t.removeEventListener("parked",this.eventhandlers.parked)}waypointIsFinalApproch(t){let i=this.runway.start.subtract(t),e=i.azimuth(),s=i.length(),a=e.between(this.runway.maxRightAzimuth,this.runway.maxLeftAzimuth,!1);return s.between(this.runway.snapDistance/2,this.runway.snapDistance,!1)&&a}canLand(){return!this.runway.closed}orderPrepareTakeoff(t){console.debug("FINISHED REARMING, PREPARE TAKEOFF",t);for(const i of this.takeoffPositions)if(i.isEmpty()){i.aircraft=t,t.addParkingWaypoint(i.position,i.direction),this.shiftRearmQueue();break}}orderTakeoff(){console.debug("TAKEOFF TRIGGERED");for(const t of this.takeoffPositions)t.aircraft?.state===s.TAKEOFF_RDY&&(t.aircraft.takeoff(),console.debug("TAKEOFF",t.aircraft),t.aircraft=null)}update(t){this.runway.update(t),this.runway.closed=!this.rearmPosition.hasQueueSpace()}draw(t,i=!1,e=!1){this.image.draw(t,this.center,this.config.direction,this.config.scale),this.runway.draw(t,i,e)}runwayStart(){return this.runway.start}shiftRearmQueue(){let t=this.rearmPosition.shiftQueue();for(const i of t)i.aircraft?.addParkingWaypoint(i.position,i.direction)}handlerGenerator(t,...i){let e=this;return function(s){return t.call(e,s,...i)}}onAircraftLanding(t){let i=t.target;console.debug("LANDING",i);let e=this.rearmPosition.addToQueue(i);if(null===e)throw new Error("No space for aircraft to wait.");let s=this.runway.start.add(this.runway.end).scaleSelf(.5),a=this.runway.start.add(s).scaleSelf(.5);i.addWaypoint(a),i.addWaypoint(s),i.addParkingWaypoint(e.position,e.direction)}onAircraftParked(t){let i=t.target;if(console.debug("PARKED",i),this.rearmPosition.aircraft!==i){for(const t of this.takeoffPositions)if(t.aircraft===i){i.prepareTakeoff();for(const e of t.path)i.addWaypoint(e);return}}else i.startRearm(this.config.rearmDuration)}absPos(i,e){return this.center.add(new t(i,e))}}class T{constructor(i,e,s,a){this.topLeft=new t(i,e),this.bottomRight=new t(i+s,e+a),this.width=s,this.height=a}isHitboxOutside(t,i){return t.x+i<this.topLeft.x||t.x-i>this.bottomRight.x||t.y+i<this.topLeft.y||t.y-i>this.bottomRight.y}isPositionOutside(t){return t.x<this.topLeft.x||t.x>this.bottomRight.x||t.y<this.topLeft.y||t.y>this.bottomRight.y}}var S;!function(t){t[t.PLAYING=0]="PLAYING",t[t.GAME_OVER=1]="GAME_OVER"}(S||(S={}));class v{constructor(){this._lastUpdate=0,this._elapsed=0}update(t){this._elapsed=t-this._lastUpdate,this._lastUpdate=t}get elapsed(){return this._elapsed}get lastUpdate(){return this._lastUpdate}}const P=8,F=15;const E=function(t){const i=document.getElementById(t);if(!i)throw new Error(`Invalid canvas id ${t}.`);const e=i.getContext("2d");if(!e)throw new Error(`Could not get context of canvas with id ${t}.`);return e.canvas.width=document.documentElement.clientWidth,e.canvas.height=document.documentElement.clientHeight,e}("canvas01"),R=new class{constructor(e){this.settings={aircraftSpawnRate:4e3,spawnProtectionDuration:4e3,maxAircraft:1},this.aircraft=[],this.nextAircraftSpawnTime=0,this.selectedAircraft=null,this.selectedAircraftTouchId=-1,this.gameState=S.PLAYING,this.twoFingerSwipePath=null,this.score=0,this.context=e,console.debug("CANVAS SIZE","W:",this.context.canvas.width,"H:",this.context.canvas.height),this.settings.maxAircraft=this.context.canvas.width<550?P:F,this.flyZone=new T(0,0,this.context.canvas.width,this.context.canvas.height),this.gameTime=new v;let s=i(this.context);this.aircraftCarrier=new b(new t(s.x,s.y-50)),this.addEventHandlers()}update(t){if(this.gameTime.update(t),this.gameState!==S.GAME_OVER){if(this.aircraftCarrier.update(this.gameTime),this.aircraft.length<this.settings.maxAircraft&&this.nextAircraftSpawnTime<this.gameTime.lastUpdate){this.nextAircraftSpawnTime=this.gameTime.lastUpdate+this.settings.aircraftSpawnRate;let t=this.spawnAircraft();console.debug("SPAWNING AIRCRAFT",t),this.aircraft.push(t)}for(let t=this.aircraft.length-1;t>=0;t--){let i=this.aircraft[t];i.state===s.TAKEOFF&&i.isOutsideFlyzone()&&(console.debug("REMOVING AIRCRAFT",i),this.score++,this.removeAircraft(i))}for(let t=0;t<this.aircraft.length;t++){let i=this.aircraft[t];for(let e=t+1;e<this.aircraft.length-t;e++){let t=this.aircraft[e];i.collidesWith(t)&&(i.setCollided(),t.setCollided(),this.gameState=S.GAME_OVER)}i.hasFinalApproch&&!this.aircraftCarrier.canLand()&&i.clearPath(),i.update(this.gameTime)}}}spawnAircraft(){let t=Math.random()*n,i=this.randomSpawnPosition(t),e=new f(i,t,this.flyZone);return e.disableCollision(this.settings.spawnProtectionDuration),this.aircraftCarrier.addAircraftEventHandler(e),e}randomSpawnPosition(i){const e=this.context.canvas.width,s=this.context.canvas.height;let a,r,h=Math.PI/4,n=h+o;return i.between(h,n,!0)?(a=Math.random()>.5?c(.1*e,.4*e):c(.6*e,.9*e),r=-25):i.between(n,h+Math.PI,!0)?(a=e+25,r=c(.1*s,.9*s)):i.between(h+Math.PI,n+Math.PI,!0)?(a=Math.random()>.5?c(.1*e,.4*e):c(.6*e,.9*e),r=s+25):(a=-25,r=c(.1*s,.9*s)),new t(a,r)}removeAircraft(t){this.aircraftCarrier.removeAircraftEventHandler(t);let i=this.aircraft.indexOf(t);i<0||this.aircraft.splice(i,1)}draw(){this.drawScore(),this.aircraftCarrier.draw(this.context,null!==this.selectedAircraft,this.selectedAircraft?.hasFinalApproch??!1),this.drawAllAircraft(),this.drawTwoFingerSwipePath(),this.gameState===S.GAME_OVER&&this.drawGameOver()}drawAllAircraft(){for(const t of this.aircraft)t.drawPath(this.context);for(const t of this.aircraft){if(t.state===s.FLYING)continue;let i=t===this.selectedAircraft;t.draw(this.context,i)}for(const t of this.aircraft){if(t.state!==s.FLYING)continue;let i=t===this.selectedAircraft;t.draw(this.context,i)}}drawGameOver(){this.context.fillStyle="gray",this.context.globalAlpha=.6,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.globalAlpha=1;let t=i(this.context),e=this.context.canvas.width<550?a.phone:a.tablet;this.context.fillStyle="white",this.context.font=`${e.XLarge}px Arial`,this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER",t.x,t.y-60),this.context.font=`${e.Large}px Arial`,this.context.fillText(`Score: ${this.score}`,t.x,t.y),this.context.font=`${e.Medium}px Arial`,this.context.fillText("Reload to restart game",t.x,t.y+40)}addEventHandlers(){this.context.canvas.addEventListener("touchstart",(t=>{switch(t.preventDefault(),t.targetTouches.length){case 1:this.onOneTouchStart(t);break;case 2:this.onTwoTouchStart(t)}})),this.context.canvas.addEventListener("touchmove",(t=>{switch(t.preventDefault(),t.targetTouches.length){case 1:this.onOneTouchMove(t);break;case 2:this.onTwoTouchMove(t)}})),this.context.canvas.addEventListener("touchend",(t=>{t.preventDefault(),this.OnTouchEnd(t)}))}onOneTouchStart(t){let i=t.targetTouches[0],e=this.getPos(i),a=e.subtract(this.aircraftCarrier.center);console.debug("TOUCH","Abs",e,"Rel to Carrier",a);for(const t of this.aircraft)if(t.isPositionInUnscaledHitbox(e)){let e=t.state;if(console.debug("STATE",e),e===s.FLYING)return t.clearPath(),this.selectedAircraft=t,void(this.selectedAircraftTouchId=i.identifier);e===s.REARMING&&t.hasFinishedRearming()&&this.aircraftCarrier.orderPrepareTakeoff(t)}}onOneTouchMove(i){if(null===this.selectedAircraft)return;let e=i.targetTouches[0];if(e.identifier!==this.selectedAircraftTouchId)return;let s=new t(e.clientX,e.clientY);if(this.flyZone.isPositionOutside(s))this.selectedAircraft=null;else if(this.selectedAircraft.addWaypoint(s),this.aircraftCarrier.canLand()&&this.aircraftCarrier.waypointIsFinalApproch(s)&&!this.selectedAircraft.hasFinalApproch){let t=this.aircraftCarrier.runwayStart();this.selectedAircraft.addFinalApproch(t)}}onTwoTouchStart(t){let i=this.getLerpTwoTouchPos(t);this.aircraftCarrier.takeoffSwipeArea.isInsideStart(i)&&(this.twoFingerSwipePath=[i])}onTwoTouchMove(t){this.twoFingerSwipePath?.push(this.getLerpTwoTouchPos(t))}OnTouchEnd(t){if(this.selectedAircraft=null,!this.twoFingerSwipePath||this.twoFingerSwipePath.length<2)return void(this.twoFingerSwipePath=null);let i=this.twoFingerSwipePath[this.twoFingerSwipePath.length-1];if(this.aircraftCarrier.takeoffSwipeArea.isInsideEnd(i)){let t=!0;for(const i of this.twoFingerSwipePath)if(!this.aircraftCarrier.takeoffSwipeArea.isInside(i)){t=!1;break}t&&this.aircraftCarrier.orderTakeoff()}this.twoFingerSwipePath=null}getLerpTwoTouchPos(i){let e=i.targetTouches[0],s=i.targetTouches[1],a=this.getPos(e),r=this.getPos(s);return t.lerp(a,r,.5)}getPos(i){return new t(i.clientX,i.clientY)}drawTwoFingerSwipePath(){if(this.twoFingerSwipePath){this.context.strokeStyle="white",this.context.lineWidth=4;for(let t=0;t<this.twoFingerSwipePath.length-1;t++)h(this.context,this.twoFingerSwipePath[t],this.twoFingerSwipePath[t+1])}}drawScore(){let t=this.context.canvas.width<550?a.phone:a.tablet;this.context.fillStyle="white",this.context.font=`${t.Medium}px Arial`,this.context.textAlign="right",this.context.textBaseline="top",this.context.lineWidth=4,this.context.fillText(`Score: ${this.score}`,.85*this.context.canvas.width,.015*this.context.canvas.height)}}(E);window.requestAnimationFrame((function t(i){!function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}(E),R.update(i),R.draw(),window.requestAnimationFrame(t)}))})()})();